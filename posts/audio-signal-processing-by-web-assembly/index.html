<!DOCTYPE html>
<html lang="ja-jp">
<head>
    <title>Audio Processing by WebAssembly &middot; rilakkuma3xjapan</title>
    <meta name="generator" content="Hugo 0.105.0">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="Korilakkuma">
    
      <meta name="description" content="WebAssembly ã§ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹">
    
    
      <link href="%7balternate%20%7bRSS%20application/rss&#43;xml%20%20index%20alternate%20%20false%20false%20true%20false%20false%200%7d%20/index.xml%20https://rilakkuma3xjapan.website/index.xml%7d" rel="alternate" type="application/rss+xml" title="rilakkuma3xjapan" />
      <link href="%7balternate%20%7bRSS%20application/rss&#43;xml%20%20index%20alternate%20%20false%20false%20true%20false%20false%200%7d%20/index.xml%20https://rilakkuma3xjapan.website/index.xml%7d" rel="feed" type="application/rss+xml" title="rilakkuma3xjapan" />
    
    <link rel="canonical" href="https://rilakkuma3xjapan.website/posts/audio-signal-processing-by-web-assembly/"/>
    <link rel="icon" href="favicon.png" type="image/png" />
    <link rel="apple-touch-icon" href="icon.png" />
    <link rel="stylesheet" href="https://rilakkuma3xjapan.website/css/style.css">
    <link rel="stylesheet" href="https://rilakkuma3xjapan.website/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://rilakkuma3xjapan.website/css/monokai.css">
    <link rel="stylesheet" href="https://rilakkuma3xjapan.website/fancybox/jquery.fancybox.css">
    
    <link rel="stylesheet" href="https://rilakkuma3xjapan.website/css/main.css">
    
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
    <meta property="og:title" content="Audio Processing by WebAssembly" />
<meta property="og:description" content="WebAssembly ã§ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rilakkuma3xjapan.website/posts/audio-signal-processing-by-web-assembly/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-14T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-05-14T00:00:00+00:00" />


    <meta itemprop="name" content="Audio Processing by WebAssembly">
<meta itemprop="description" content="WebAssembly ã§ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹"><meta itemprop="datePublished" content="2022-05-14T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-05-14T00:00:00+00:00" />
<meta itemprop="wordCount" content="3456">
<meta itemprop="keywords" content="WebAssembly,WebAssembly Text format,WAT,Web Audio API," />
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Audio Processing by WebAssembly"/>
<meta name="twitter:description" content="WebAssembly ã§ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹"/>

    

    
    <style>
        #main {
            display: 100% !important;
        }

        @media screen and (min-width: 1200px) {
            #main {
                width: calc(200px + 52.307692307692314%);
            }
        }

        @media screen and (min-width: 1200px) {
            #sidebar {
                 width: calc(50px + 21.53846153846154%);
            }
        }
    </style>
    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
</head>
<body>
<div class="container">


<div id="container">
	<header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="https://rilakkuma3xjapan.website" id="logo">
          
          <i class="logo" style="background-image: url('https://rilakkuma3xjapan.website/icon.png')"></i>
          
          <span class="site-title">rilakkuma3xjapan</span>
      </a>
      <nav id="main-nav">
          
          
          <a class="main-nav-link" href="https://rilakkuma3xjapan.website/">Home</a>
          
          
          
          
          
          

          
          <a class="main-nav-link" href="https://rilakkuma3xjapan.website/about/">About</a>
          

          
          
          
          
          <a class="main-nav-link" href="https://rilakkuma3xjapan.website/tags/">Tags</a>
          
          
          
          <a class="main-nav-link" href="https://rilakkuma3xjapan.website/categories/">Categories</a>
          
          
      </nav>
        <nav id="sub-nav">
          <div class="profile" id="profile-nav">
            <a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://rilakkuma3xjapan.website/profile.png"><i class="fa fa-caret-down"></i></a>
          </div>
        </nav>
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form">
              <input type="search" name="q" class="search-form-input" placeholder="Search">
              <button type="submit" class="search-form-submit">
              </button>
              <input type="hidden" name="sitesearch" value="https://rilakkuma3xjapan.website" />
         </form>
        </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tbody>
          <tr>
          
          
          <td><a class="main-nav-link" href="https://rilakkuma3xjapan.website/">Home</a></td>
          
          
          
          
          
          

          
          <td><a class="main-nav-link" href="https://rilakkuma3xjapan.website/about/">About</a></td>
          

          
          
          
          
          <td><a class="main-nav-link" href="https://rilakkuma3xjapan.website/tags/">Tags</a></td>
          
          
          
          <td><a class="main-nav-link" href="https://rilakkuma3xjapan.website/categories/">Categories</a></td>
          
          
          <td>
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form">
          <input type="search" name="q" class="search-form-input" placeholder="Search">
          <input type="hidden" name="sitesearch" value="https://rilakkuma3xjapan.website" />
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</header>


   	<div class="outer">
    	<aside id="profile">
  <div class="inner profile-inner">
    <div class="base-info profile-block">
      
      <img id="avatar" src="https://www.gravatar.com/avatar/2ec58acf24bf70ddd571739af8e934e7?s=100&d=identicon"/>
      
      <h2 id="name">Korilakkuma</h2>
      <h3 id="title">I&#39;m disseminating Web Music as Audio Programmer. C, WebAssembly, TypeScript, Audio Signal Processing (ALSA, Web Audio) and Music ğŸ’–ğŸ¸ğŸ¹</h3>
      <span id="location"><i class="fa fa-map-marker"></i>Osaka (sometimes Tokyo), JAPAN</span>
      
    </div>
    <div class="profile-block social-links">
      <table>
        <tr>
          
<td><a href="//github.com/Korilakkuma" target="_blank" title="GitHub"><i class="fa fa-github"></i></a></td>























<td><a href="//youtube.com/rilakkuma3xjapan" target="_blank" title="YouTube"><i class="fa fa-youtube"></i></a></td>















<td><a href="//linkedin.com/in/%e5%8f%8b%e6%b4%8b-%e6%b1%a0%e7%94%b0-901725b8" target="_blank" title="LinkedIn"><i class="fa fa-linkedin"></i></a></td>
















          <td><a href="%7balternate%20%7bRSS%20application/rss&#43;xml%20%20index%20alternate%20%20false%20false%20true%20false%20false%200%7d%20/about/index.xml%20https://rilakkuma3xjapan.website/about/index.xml%7d" target="_blank" title="RSS"><i class="fa fa-rss"></i></a></td>
        </tr>
      </table>
    </div>
  </div>
</aside>


    <section id="main">
    
    <article id="page-undefined" class="article article-type-page" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        

        <header class="article-header">
    <a href="https://rilakkuma3xjapan.website/posts/audio-signal-processing-by-web-assembly/">
    <h1 class="article-title" itemprop="name">
        Audio Processing by WebAssembly
    </h1>
    </a>
    <div class="article-meta">

        
        <div class="article-date">
            <i class="fa fa-calendar"></i>
            <time datetime="2022-05-14 00:00:00 &#43;0000 UTC" itemprop="datePublished">2022-05-14</time>
            &middot;
            3456
            words
            &middot;
            7
            minute read
        </div>
        
        
            
            
            <div class="article-category">
                <i class="fa fa-folder"></i>
                
                
                <a class="article-category-link" href="https://rilakkuma3xjapan.website/categories/programming">Programming</a>
                &middot;
                
                
                <a class="article-category-link" href="https://rilakkuma3xjapan.website/categories/audio">Audio</a>
                
                
            </div>
            
        

        
            
            
            <div class="article-category">
                <i class="fa fa-tags"></i>
                
                
                <a class="article-category-link" href="https://rilakkuma3xjapan.website/tags/webassembly">WebAssembly</a>
                &middot;
                
                
                <a class="article-category-link" href="https://rilakkuma3xjapan.website/tags/webassembly-text-format">WebAssembly Text format</a>
                &middot;
                
                
                <a class="article-category-link" href="https://rilakkuma3xjapan.website/tags/wat">WAT</a>
                &middot;
                
                
                <a class="article-category-link" href="https://rilakkuma3xjapan.website/tags/web-audio-api">Web Audio API</a>
                
                
            </div>
            
        
    </div>
</header>

        <div class="article-entry" itemprop="articleBody">
            <h1 id="webassembly">WebAssembly</h1>
<p><strong>WebAssembly</strong> ã¨ã¯, ã‚¹ã‚¿ãƒƒã‚¯ãƒã‚·ãƒ³ã®ãŸã‚ã®<strong>ä»®æƒ³å‘½ä»¤ã‚»ãƒƒãƒˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</strong> (<strong>Virtual ISA</strong>: <strong>V</strong>irtual <strong>I</strong>nstruction <strong>S</strong>et <strong>A</strong>rchitecture) ã®ã“ã¨ã§, ã€Œä»®æƒ³ã€ã¨å‘½åã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«, ç‰¹å®šã®ç‰©ç†çš„ãªãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚’å‰æã¨ã—ã¦è¨­è¨ˆã«ã¯ãªã£ã¦ã„ã¾ã›ã‚“ (é€†ã«, ä¸€èˆ¬çš„ãª ISA ã¯ç‰¹å®šã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã«ä¾å­˜ã—ã¾ã™). å³å¯†ã«ã¯ç•°ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒ, Java ã®çµŒé¨“ã®ã‚ã‚‹æ–¹ã§ã‚ã‚Œã°, JVM ã«è¿‘ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ (å‘½åãŒã‚„ã‚„ã“ã—ã„ã®ã§ã™ãŒ, WebAssembly ã¯ Virtual ISA ã§ã‚¢ã‚»ãƒ³ãƒ–ãƒªè¨€èªã§ã¯ã‚ã‚Šã¾ã›ã‚“. WebAssembly ã«ãŠã‘ã‚‹ã‚¢ã‚»ãƒ³ãƒ–ãƒªè¨€èªç›¸å½“ã®è¨€èªãŒå¾Œè¿°ã™ã‚‹ WAT ã§ã™).</p>
<p>ã¤ã¾ã‚Š, Web ãƒ–ãƒ©ã‚¦ã‚¶ã ã‘ã§ãªã, Node.js ã‚„çµ„ã¿è¾¼ã¿ç’°å¢ƒã§ã‚‚å®Ÿè¡Œå¯èƒ½ã§ã™. Web ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚ã‚Œã°, ãƒ¢ãƒ€ãƒ³ãƒ–ãƒ©ã‚¦ã‚¶ã™ã¹ã¦ãŒå¯¾å¿œã—ã¦ã„ã¾ã™ (ãŸã , ãƒ‡ãƒãƒƒã‚¬ãƒ¼ãªã©ãŒè±Šå¯Œãªã®ã¯ Firefox ã‚„ Chrome ã«ãªã‚Šã¾ã™).</p>
<h2 id="webassembly-ã®ãƒ¡ãƒªãƒƒãƒˆ">WebAssembly ã®ãƒ¡ãƒªãƒƒãƒˆ</h2>
<h3 id="å®Ÿè¡Œãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æ”¹å–„">å®Ÿè¡Œãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æ”¹å–„</h3>
<p>ãŠãã‚‰ã, WebAssembly ã§å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹æœ€å¤§ã®ç†ç”±ã¨ãªã‚‹ã§ã—ã‚‡ã†. ã—ã‹ã—ãªãŒã‚‰, ä¸€èˆ¬çš„ã«ã‹ã‚“ã¡ãŒã„ã•ã‚ŒãŒã¡ãªã®ã§ã™ãŒ (ã‚ãŸã—ã‚‚ãã®ä¸€äººã§ã—ãŸ &hellip;), <strong>WebAssembly ã§å®Ÿè£…ã—ã¦ã‚‚å¿…ãšã—ã‚‚å®Ÿè¡Œãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒæ”¹å–„ã™ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“</strong>. ã¾ãŸ, <strong>å®Ÿè£…ã‚³ã‚¹ãƒˆã«è¦‹åˆã†ã ã‘ã®æ”¹å–„ã‚’å¾—ã‚‰ã‚Œã‚‹ã¨ã‚‚é™ã‚Šã¾ã›ã‚“</strong>. ç†ç”±ã¨ã—ã¦ã¯, <strong>JavaScript ã‹ã‚‰ WebAssembly ã§å®Ÿè£…ã•ã‚ŒãŸé–¢æ•°ã‚’å‘¼ã³å‡ºã™ã‚ªãƒ¼ãƒãƒ˜ãƒƒãƒ‰ãŒãã‚Œãªã‚Šã«å¤§ãã„</strong>ã“ã¨ã‚„, ç¾çŠ¶ã® WebAssembly ã¯, <strong>æ•°å€¤ (32 bit, 64 bit ã®æ•´æ•°ã¨æµ®å‹•å°æ•°ç‚¹æ•°) æ¼”ç®—ã«å¯¾ã—ã¦é«˜é€Ÿã§ã‚ã‚Š, æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ (æ–‡å­—åˆ—ã‚„é…åˆ—) ã‚’ã‚ã¤ã‹ã†ã“ã¨ã‚’ã‚ã¾ã‚Šå¾—æ„ã¨ã—ã¦ã„ã¾ã›ã‚“</strong>. <strong>ç·šå½¢ãƒ¡ãƒ¢ãƒª</strong> (C/C++ ã§ã„ã†ãƒ’ãƒ¼ãƒ—é ˜åŸŸ, JavaScript ã§ã„ã† ArrayBuffer ã®ã‚ˆã†ãªãƒ¡ãƒ¢ãƒªé ˜åŸŸ) ã‚’ <strong>JavaScript ã¨ WebAssembly ã®é–“ã§ãƒã‚¤ãƒ³ã‚¿ã®ã‚ˆã†ã«å…±æœ‰ã—ã¦æ“ä½œã™ã‚‹å¿…è¦ãŒã‚ã‚‹</strong>ã®ã§å®Ÿè£…ã‚³ã‚¹ãƒˆãŒè‚¥å¤§åŒ–ã—ãŒã¡ã§ã™. ã¾ãŸ, <strong>DOM ã‚’ç›´æ¥æ“ä½œã™ã‚‹ã“ã¨ã‚‚ã§ããªã„</strong>ã®ã§, å®Ÿéš›ã®é–‹ç™ºã§ã¯, ã™ã¹ã¦ã‚’ WebAssembly ã§æ›¸ãæ›ãˆã‚‹ã®ã¯ç¾å®Ÿçš„ã«ä¸å¯èƒ½ã§ã‚ã‚Š, <strong>æœ€é©åŒ–ã™ã‚‹å‡¦ç†ã‚’ååˆ†ã«æ¤œè¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</strong>.</p>
<h3 id="æ—¢å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ´»ç”¨">æ—¢å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ´»ç”¨</h3>
<p>ã‚‚ã—, C/C++ ã‚„ Rust, Go ã®ã‚ˆã†ãªé«˜ç´šè¨€èªã§å®Ÿè£…ã—ã¦, <a href="https://emscripten.org/">Ecmascripten</a> ãªã©ã®ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã‚’åˆ©ç”¨ã—ã¦, WebAssembly ã®å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ« (wasm) ã‚’ç”Ÿæˆã™ã‚‹å ´åˆ, ã“ã‚Œã¾ã§ã®è³‡ç”£ã®å¤šããŒæ´»ç”¨ã§ãã¾ã™. ã—ã‹ã—, å®Ÿè¡Œãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€å¤§é™ã«å¼•ãå‡ºã—ãŸã„å ´åˆ, å¾Œè¿°ã™ã‚‹ WAT ã‚„ AssemblyScript ã»ã©ã®æœ€é©åŒ–ã‚’æœ›ã‚ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“. WebAssembly ã‚’ä½¿ã†ç›®çš„ã‚’æ˜ç¢ºã«ã—ã¦, ã“ã®ãƒ¡ãƒªãƒƒãƒˆã‚’è€ƒãˆã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã™.</p>
<h3 id="ç§»æ¤æ€§ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£">ç§»æ¤æ€§ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</h3>
<p>WebAssembly ã¯, Web ãƒ–ãƒ©ã‚¦ã‚¶ã§å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã¨ã—ã¦å§‹ã¾ã£ãŸçµŒç·¯ãŒã‚ã‚Š, ã©ã“ã§ã‚‚å®Ÿè¡Œã§ãã‚‹ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒã¸ç™ºå±•ã—ã¾ã—ãŸ. ã¾ãŸ, éå¸¸ã«å®‰å…¨ãªãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’ä½œæˆã—ã¦ã„ã¾ã™. ç¾åœ¨ã§ã¯, Web ãƒ–ãƒ©ã‚¦ã‚¶ã ã‘ã§ãªã, ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ã‚‚, çµ„ã¿è¾¼ã¿ç’°å¢ƒã§ã‚‚åŒæ§˜ã«ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™.</p>
<h4 id="wasi">WASI</h4>
<p>WASI (<strong>W</strong>eb<strong>A</strong>ssembly <strong>S</strong>ystem <strong>I</strong>nterface) ã¯, WebAssembly ã®ãƒ©ã‚¤ã‚¿ã‚¤ãƒ ä»•æ§˜ã§, WebAssembly ãŒ OS ã®æ©Ÿèƒ½ã‚’å‘¼ã³å‡ºã™ãŸã‚ã®ä»•çµ„ã¿, ã™ãªã‚ã¡, WebAssembly ç‰ˆã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã®ã‚ˆã†ãªã‚‚ã®ã§ã™. å…·ä½“çš„ã«ã¯, WebAssembly ã‹ã‚‰ I/O å‡¦ç†ã—ãŸã‚Š, ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ã£ãŸã‚Šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™.</p>
<h2 id="webassembly-text-format-wat">WebAssembly Text format (WAT)</h2>
<p><strong>WAT</strong> (<strong>W</strong>eb<strong>A</strong>ssembly <strong>T</strong>ext format) ã¯ WebAssembly (ä»®æƒ³ãƒã‚·ãƒ³) ã«ãŠã‘ã‚‹ã‚¢ã‚»ãƒ³ãƒ–ãƒªè¨€èªã«ç›¸å½“ã—ã¾ã™.
å®Ÿãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ç”Ÿç”£æ€§ã‚’è€ƒæ…®ã™ã‚‹ã¨, WAT ã§å®Ÿè£…ã™ã‚‹æ©Ÿä¼šã¯ã»ã¨ã‚“ã©ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒ, æ¥µé™ã¾ã§ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã«è¿‘ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ç™ºæ®ã—ãŸã„å ´åˆã«, WebAssembly ãŒãƒ­ãƒ¼ãƒ¬ãƒ™ãƒ«ã§ãªã«ã‚’ã—ã¦ã„ã‚‹ã®ã‹ã‚’çŸ¥ã£ã¦ã„ã‚‹ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã®ç”Ÿç”£æ€§ã‚’å‘ä¸Šã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“.</p>
<p>ã•ã‚‰ã«, WAT ã¯ä»–ã®ã‚¢ã‚»ãƒ³ãƒ–ãƒªè¨€èªã¨æ¯”è¼ƒã™ã‚‹ã¨å‘½ä»¤ã‚»ãƒƒãƒˆã¯å°‘ãªã, <strong>æ•°å€¤æ¼”ç®—ã®å‘½ä»¤ã‚»ãƒƒãƒˆãŒåŸºæœ¬ã§ã™</strong> (åŠ æ¸›ä¹—é™¤, å‰°ä½™, ã‚·ãƒ•ãƒˆæ¼”ç®—, æ¯”è¼ƒæ¼”ç®—, è«–ç†æ¼”ç®— &hellip; etc). ãã—ã¦, ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿å‹ã‚‚, i32, i64, f32, f64 (32 bit ã¨ 64 bit ã®æ•´æ•°ã¨æµ®å‹•å°æ•°ç‚¹æ•°) ã® 4 ç¨®é¡ã®ã¿ã§ã™.
ã‚‚ã¡ã‚ã‚“, å°†æ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã«ã‚ˆã£ã¦, å‘½ä»¤ã‚»ãƒƒãƒˆã‚„ãƒ‡ãƒ¼ã‚¿å‹ã‚‚å¢—ãˆã‚‹å¯èƒ½æ€§ã¯ã‚ã‚Šã¾ã™ãŒ, å·®åˆ†ã®ç¿’å¾—ã ã‘ã§ã™ã¿ã¾ã™
(ã¡ãªã¿ã«, æ•°å€¤æ¼”ç®—ä»¥å¤–ã®å‘½ä»¤ã‚»ãƒƒãƒˆã§ã‚ˆãä½¿ã†å‘½ä»¤ã‚»ãƒƒãƒˆã¯, ç·šå½¢ãƒ¡ãƒ¢ãƒªã‹ã‚‰èª­ã¿è¾¼ã‚€ <code>load</code>, ç·šå½¢ãƒ¡ãƒ¢ãƒªã«æ›¸ãè¾¼ã‚€ <code>store</code> å‘½ä»¤ãŒã‚ã‚Šã¾ã™).</p>
<h2 id="webassembly-ã®é–‹ç™ºç’°å¢ƒ">WebAssembly ã®é–‹ç™ºç’°å¢ƒ</h2>
<p>WebAssembly ã®é–‹ç™ºç’°å¢ƒ (ãƒ„ãƒ¼ãƒ«) ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã™ãŒ, ã“ã®ãƒ–ãƒ­ã‚°ã§ã¯, WAT ã‚’å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ« (wasm) ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã®ã¿ãªã®ã§, <a href="https://github.com/battlelinegames/wat-wasm">wat-wasm</a> ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ (WAT ãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å¯èƒ½ã§ã‚ã‚Œã°ãªã‚“ã§ã‚‚ã‚ˆã„ã§ã—ã‚‡ã†).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ npm install -g wat-wasm
</span></span></code></pre></div><h2 id="web-audio-api-ã¨-webassembly">Web Audio API ã¨ WebAssembly</h2>
<p>Web Audio API ã® API è¨­è¨ˆã¯, Web Audio API ãŒå®šç¾©ã™ã‚‹ <code>AudioNode</code> ã‚’æ¥ç¶šã—ã¦é«˜åº¦ãªã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã™ãŒ, ãã®è¨­è¨ˆã«ã—ãŸãŒã†ã ã‘ã§ã¯, å®Ÿè£…ã§ããªã„ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã‚‚å­˜åœ¨ã—ã¾ã™.</p>
<ul>
<li>ãƒã‚¤ã‚º</li>
<li>ãƒœãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒ³ã‚»ãƒ©</li>
<li>ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆ / ãƒã‚¤ã‚ºã‚µãƒ—ãƒ¬ãƒƒã‚µ</li>
<li>ãƒãƒ£ãƒ³ãƒãƒ«ã®ã”ã¨ã® FFT / IFFT</li>
<li>ãƒ”ãƒƒãƒã‚·ãƒ•ã‚¿ãƒ¼</li>
<li>ã‚¿ã‚¤ãƒ ã‚¹ãƒˆãƒ¬ãƒƒãƒ</li>
</ul>
<p>ä¾‹ã¨ã—ã¦, ä¸Šè¨˜ã«ã‚ã’ãŸã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã¯, ç›´æ¥éŸ³ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦, ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ (ãã®ãŸã‚ã® <code>AudioNode</code> ãŒ <strong><code>ScriptProcessorNode</code></strong> (éæ¨å¥¨), <strong><code>AudioWorklet</code></strong> ã§ã™).</p>
<p>ãã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã‚’ JavaScript ã§å®Ÿè£…ã—ã¦ã‚‚ã‚ˆã„ã®ã§ã™ãŒ, ã‚ˆã‚Šé«˜é€ŸåŒ–ã‚’ã¯ã‹ã‚‹ã®ã§ã‚ã‚Œã°, WebAssembly ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§è§£æ±ºã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“.</p>
<h2 id="å®Ÿè£…">å®Ÿè£…</h2>
<p>ãƒœãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒ³ã‚»ãƒ©ã¨ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆã‚’ WebAssembly ã§å®Ÿè£…ã—ã¦ã¿ã¾ã™.</p>
<h3 id="ãƒœãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒ³ã‚»ãƒ©">ãƒœãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒ³ã‚»ãƒ©</h3>
<p>ãƒœãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒ³ã‚»ãƒ©ã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã¯å˜ç´”ãªæ•°å€¤æ¼”ç®—ã§, å·¦å³ã®ãƒãƒ£ãƒ³ãƒãƒ«ã®å…¥åŠ›ã®å·®ã‚’å‡ºåŠ›ã®ã‚µã‚¦ãƒ³ãƒ‰ãƒ‡ãƒ¼ã‚¿ã«ã™ã‚‹ã“ã¨ã§, ãƒœãƒ¼ã‚«ãƒ«ãƒ‘ãƒ¼ãƒˆã‚’é™¤å»ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ (<code>depth</code> ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§, é™¤å»ã®åº¦åˆã„ã‚’èª¿æ•´ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™).</p>
<p>WAT ã«ã¯, 2 ç¨®é¡ã®è¨˜è¿°ã‚¹ã‚¿ã‚¤ãƒ«ãŒã‚ã‚Š, 1 ã¤ãŒã‚¹ã‚¿ãƒƒã‚¯ãƒã‚·ãƒ³ã‚’ãã®ã¾ã¾è¨˜è¿°ã™ã‚‹<strong>ç·šå½¢å‘½ä»¤ãƒªã‚¹ãƒˆ</strong>ã‚¹ã‚¿ã‚¤ãƒ«, ãã—ã¦, ã‚‚ã† 1 ã¤ãŒ, ã‚„ã‚„é«˜ç´šè¨€èªãƒ©ã‚¤ã‚¯ã«, å‘½ä»¤ã‚»ãƒƒãƒˆ (ã‚ªãƒšãƒ¬ãƒ¼ã‚¿) ã¨å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ (ã‚ªãƒšãƒ©ãƒ³ãƒ‰) ã‚’æœ¨æ§‹é€ ã®ã‚ˆã†ã«è¨˜è¿°ã™ã‚‹ <strong>Så¼</strong> (<strong>S-expression</strong>) ã‚¹ã‚¿ã‚¤ãƒ«ã§ã™.</p>
<p>é«˜ç´šè¨€èªã«æ…£ã‚ŒãŸæ–¹ã«ã¯, S å¼ã®æ–¹ãŒé¦´æŸ“ã¿ã‚„ã™ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒ, S å¼ã§è¨˜è¿°ã™ã‚‹ã«ã—ã¦ã‚‚, ã‚¹ã‚¿ãƒƒã‚¯ãƒã‚·ãƒ³ (ç·šå½¢å‘½ä»¤ãƒªã‚¹ãƒˆ) ã‚’è€ƒæ…®ã—ã¦å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§, å¾ã€…ã«ç·šå½¢å‘½ä»¤ãƒªã‚¹ãƒˆã«æ…£ã‚Œã¦ã„ãã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™.</p>
<p>ãƒ‡ãƒ¼ã‚¿å‹, å‘½ä»¤ã‚»ãƒƒãƒˆ, ç°¡æ˜“çš„ãªåˆ¶å¾¡æ§‹æ–‡, ãã—ã¦, ç·šå½¢ãƒ¡ãƒ¢ãƒªã®æ“ä½œãªã©ã¯, ãã‚Œãªã‚Šã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ã«ãªã‚‹ã®ã§, ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãªã©ã‚’å‚ç…§ã—ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™.</p>
<h4 id="ç·šå½¢å‘½ä»¤ãƒªã‚¹ãƒˆ">ç·šå½¢å‘½ä»¤ãƒªã‚¹ãƒˆ</h4>
<p>ç·šå½¢å‘½ä»¤ãƒªã‚¹ãƒˆã§å®Ÿè£…ã—ãŸ, ãƒœãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒ³ã‚»ãƒ©ã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã§ã™.
ã‚¹ã‚¿ãƒƒã‚¯ã§å®Ÿè£…å¯èƒ½ãª, é€†ãƒãƒ¼ãƒ©ãƒ³ãƒ‰è¨˜æ³• (å¾Œç½®è¨˜æ³•) ã«æ…£ã‚Œã¦ã„ã‚‹ã¨, ç†è§£ã—ã‚„ã™ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“.</p>
<pre tabindex="0"><code>(module
  (func (export &#34;vocalcanceler&#34;) (param $left f32) (param $right f32) (param $depth f32) (result f32)
    local.get $left
    local.get $right
    local.get $depth
    f32.mul
    f32.sub
  )
)
</code></pre><h4 id="s-å¼-s-expression">S å¼ (S-expression)</h4>
<p>S å¼ã§å®Ÿè£…ã—ãŸ, ãƒœãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒ³ã‚»ãƒ©ã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã§ã™.
ç·šå½¢å‘½ä»¤ãƒªã‚¹ãƒˆã¨æ¯”è¼ƒã™ã‚‹ã¨, ã‚„ã‚„é«˜ç´šè¨€èªã«è¿‘ã„è¨˜è¿°ã«ãªã‚Šã¾ã™.</p>
<pre tabindex="0"><code>(module
  (func (export &#34;vocalcanceler&#34;) (param $left f32) (param $right f32) (param $depth f32) (result f32)
    (f32.sub (local.get $left) (f32.mul (local.get $depth) (local.get $right)))
  )
)
</code></pre><h4 id="ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«">ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«</h4>
<p><code>wat-wasm</code> ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨, WAT ã‹ã‚‰ WebAssembly ã®ãƒã‚¤ãƒŠãƒª (å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«) ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ <code>wat2wasm</code> ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã®ã§, ã“ã®ã‚³ãƒãƒ³ãƒ‰ã§ WAT ã‚’ wasm ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¾ã™.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ wat2wasm vocalcanceler.wat
</span></span></code></pre></div><h4 id="wasm-ã®èª­ã¿è¾¼ã¿">wasm ã®èª­ã¿è¾¼ã¿</h4>
<p>Node.js ã§ã‚ã‚Œã°, ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã®ã§, wasm ã‚’èª­ã¿è¾¼ã¿, å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¤ãƒ³ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ã¦, WebAssembly ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JavaScript" data-lang="JavaScript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fs</span>    <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;fs&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">bytes</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">readFileSync</span>(<span style="color:#e6db74">`{__dirname}/vocalcanceler.wasm`</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WebAssembly</span>
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">instantiate</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Uint8Array</span>(<span style="color:#a6e22e">bytes</span>))
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">then</span>(({ <span style="color:#a6e22e">instance</span> }) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// do something ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  })
</span></span><span style="display:flex;"><span>  .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>);
</span></span></code></pre></div><p>Web ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¢ã‚¯ã‚»ã™ã‚‹ã“ã¨ã¯ã§ããªã„ã®ã§, ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸ wasm ã‚’ <code>fetch</code> ã‚’åˆ©ç”¨ã—ã¦, å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ãã®æˆ»ã‚Šå€¤ã§ã‚ã‚‹, <code>Promise&lt;ArrayBuffer&gt;</code> ã‚’ <code>instantiateStreaming</code> ã«æ¸¡ã—ã¾ã™.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JavaScript" data-lang="JavaScript"><span style="display:flex;"><span><span style="color:#a6e22e">WebAssembly</span>
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">instantiateStreaming</span>(<span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;./vocalcanceler.wasm&#39;</span>))
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">then</span>(({ <span style="color:#a6e22e">instance</span> }) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// do something ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  })
</span></span><span style="display:flex;"><span>  .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>);
</span></span></code></pre></div><h4 id="webassembly-ã®é–¢æ•°å‘¼ã³å‡ºã—">WebAssembly ã®é–¢æ•°å‘¼ã³å‡ºã—</h4>
<p>Web Audio API ã® <code>ScriptProcessorNode</code> ã‚’åˆ©ç”¨ã—ã¦, ãã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—, ãƒœãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒ³ã‚»ãƒ©ã®ãŸã‚ã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JavaScript" data-lang="JavaScript"><span style="display:flex;"><span><span style="color:#a6e22e">WebAssembly</span>
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">instantiateStreaming</span>(<span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;./vocalcanceler.wasm&#39;</span>))
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">then</span>(({ <span style="color:#a6e22e">instance</span> }) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// `processor` ã¯, `ScriptProcessorNode` ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">processor</span>.<span style="color:#a6e22e">onaudioprocess</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">event</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">inputLs</span>  <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">inputBuffer</span>.<span style="color:#a6e22e">getChannelData</span>(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">inputRs</span>  <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">inputBuffer</span>.<span style="color:#a6e22e">getChannelData</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">outputLs</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">outputBuffer</span>.<span style="color:#a6e22e">getChannelData</span>(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">outputRs</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">outputBuffer</span>.<span style="color:#a6e22e">getChannelData</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">bufferSize</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">outputLs</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">instance</span>.<span style="color:#a6e22e">exports</span>.<span style="color:#a6e22e">vocalcanceler</span>(<span style="color:#a6e22e">inputLs</span>[<span style="color:#a6e22e">i</span>], <span style="color:#a6e22e">inputRs</span>[<span style="color:#a6e22e">i</span>], <span style="color:#a6e22e">depth</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">outputRs</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">instance</span>.<span style="color:#a6e22e">exports</span>.<span style="color:#a6e22e">vocalcanceler</span>(<span style="color:#a6e22e">inputRs</span>[<span style="color:#a6e22e">i</span>], <span style="color:#a6e22e">inputLs</span>[<span style="color:#a6e22e">i</span>], <span style="color:#a6e22e">depth</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>);
</span></span></code></pre></div><h3 id="ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆ">ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆ</h3>
<p>ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã‚‚å˜ç´”ãªæ•°å€¤æ¼”ç®—ã§, åˆ¶å¾¡æ§‹æ–‡ãŒå¿…è¦ãªã«ãªã‚‹ã®ã§, å°‘ã—è¤‡é›‘ã«ãªã‚Šã¾ã™.</p>
<h4 id="ç·šå½¢å‘½ä»¤ãƒªã‚¹ãƒˆ-1">ç·šå½¢å‘½ä»¤ãƒªã‚¹ãƒˆ</h4>
<p>ç·šå½¢å‘½ä»¤ãƒªã‚¹ãƒˆã§å®Ÿè£…ã—ãŸ, ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã§ã™.</p>
<pre tabindex="0"><code>(module
  (func (export &#34;noisegate&#34;) (param $input f32) (param $level f32) (result f32)
    (local $output f32)

    local.get $input
    local.get $level
    f32.gt

    local.get $input
    f32.const 0
    local.get $level
    f32.sub
    f32.lt

    i32.or

    if
      local.get $input
      local.set $output
    else
      f32.const 0
      local.set $output
    end

    local.get $output
  )
)
</code></pre><p>å°‘ã—ä½™è«‡ã§ã™ãŒ, è² æ•°ã‚’ã¨ã‚‹å ´åˆ, <code>-1</code> ã‚’ä¹—ç®—ã™ã‚‹ã‚ˆã‚Šã‚‚, <code>0</code> ã‹ã‚‰å¯¾è±¡ã®å€¤ã‚’æ¸›ç®—ã™ã‚‹æ–¹ãŒé«˜é€Ÿã§ã™.</p>
<h4 id="s-å¼-s-expression-1">S å¼ (S-expression)</h4>
<p>S å¼ã§å®Ÿè£…ã—ãŸ, ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã§ã™.</p>
<pre tabindex="0"><code>(module
  (func (export &#34;noisegate&#34;) (param $input f32) (param $level f32) (result f32)
    (local $output f32)

    (if
      (i32.or
        (f32.gt (local.get $input) (local.get $level))
        (f32.lt (local.get $input) (f32.mul (f32.const -1) (local.get $level)))
      )
      (then
        (local.set $output (local.get $input))
      )
      (else
        (local.set $output (f32.const 0))
      )
    )

    local.get $output
  )
)
</code></pre><h4 id="ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«-1">ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«</h4>
<p><code>wat-wasm</code> ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨, WAT ã‹ã‚‰ WebAssembly ã®ãƒã‚¤ãƒŠãƒª (å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«) ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ <code>wat2wasm</code> ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã®ã§, ã“ã®ã‚³ãƒãƒ³ãƒ‰ã§ WAT ã‚’ wasm ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¾ã™.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ wat2wasm noisegate.wat
</span></span></code></pre></div><h4 id="wasm-ã®èª­ã¿è¾¼ã¿-1">wasm ã®èª­ã¿è¾¼ã¿</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JavaScript" data-lang="JavaScript"><span style="display:flex;"><span><span style="color:#a6e22e">WebAssembly</span>
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">instantiateStreaming</span>(<span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;./noisegate.wasm&#39;</span>))
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">then</span>(({ <span style="color:#a6e22e">instance</span> }) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// do something ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  })
</span></span><span style="display:flex;"><span>  .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>);
</span></span></code></pre></div><h4 id="webassembly-ã®é–¢æ•°å‘¼ã³å‡ºã—-1">WebAssembly ã®é–¢æ•°å‘¼ã³å‡ºã—</h4>
<p>Web Audio API ã® <code>ScriptProcessorNode</code> ã‚’åˆ©ç”¨ã—ã¦, ãã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—, ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆã®ãŸã‚ã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JavaScript" data-lang="JavaScript"><span style="display:flex;"><span><span style="color:#a6e22e">WebAssembly</span>
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">instantiateStreaming</span>(<span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;./noisegate.wasm&#39;</span>))
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">then</span>(({ <span style="color:#a6e22e">instance</span> }) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// `processor` ã¯, `ScriptProcessorNode` ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">processor</span>.<span style="color:#a6e22e">onaudioprocess</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">event</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">inputLs</span>  <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">inputBuffer</span>.<span style="color:#a6e22e">getChannelData</span>(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">inputRs</span>  <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">inputBuffer</span>.<span style="color:#a6e22e">getChannelData</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">outputLs</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">outputBuffer</span>.<span style="color:#a6e22e">getChannelData</span>(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">outputRs</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">outputBuffer</span>.<span style="color:#a6e22e">getChannelData</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">bufferSize</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">outputLs</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">instance</span>.<span style="color:#a6e22e">exports</span>.<span style="color:#a6e22e">noisegate</span>(<span style="color:#a6e22e">inputLs</span>[<span style="color:#a6e22e">i</span>], <span style="color:#a6e22e">level</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">outputRs</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">instance</span>.<span style="color:#a6e22e">exports</span>.<span style="color:#a6e22e">noisegate</span>(<span style="color:#a6e22e">inputRs</span>[<span style="color:#a6e22e">i</span>], <span style="color:#a6e22e">level</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>);
</span></span></code></pre></div><h2 id="ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹">ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹</h2>
<ul>
<li><a href="https://www.amazon.co.jp/%E5%85%A5%E9%96%80WebAssembly-Rick-Battagline/dp/4798173592">å…¥é–€WebAssembly</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/WebAssembly/Understanding_the_text_format">Understanding WebAssembly text format</a></li>
</ul>

        </div>
        <footer class="article-footer">
    <a data-url="https://rilakkuma3xjapan.website/posts/audio-signal-processing-by-web-assembly/" data-id="b3e1979e19219697234a6c57319ad40b" class="article-share-link">
        <i class="fa fa-share"></i>
        Share
    </a>
    
    <a href="https://rilakkuma3xjapan.website/posts/audio-signal-processing-by-web-assembly/#disqus_thread" class="article-comment-link">
        Comments
    </a>
    

    <script>
    (function ($) {
        
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
    </script>
</footer>

    </div>

    
<nav id="article-nav">
    
    <a href="https://rilakkuma3xjapan.website/posts/unix-v6-simulator/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">
          Older
      </strong>
      <div class="article-nav-title">Install UNIX V6 simulator</div>
    </a>
    

    
    <a href="https://rilakkuma3xjapan.website/posts/dotfiles/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">
          Newer
      </strong>
      <div class="article-nav-title">Update dotfiles</div>
    </a>
    
</nav>


</article>


<section id="comments">
    <div id="disqus_thread">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "Korilakkuma" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
</section>


    </section>

   	
    	<aside id="sidebar">
    

    


<div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
        <ul class="category-list">
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/categories/audio">
                    audio
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/categories/development">
                    development
                </a>
                <span class="category-list-count">2</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/categories/operating-system">
                    operating-system
                </a>
                <span class="category-list-count">2</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/categories/programming">
                    programming
                </a>
                <span class="category-list-count">2</span>
            </li>
            
        </ul>
    </div>
</div>




    


<div class="widget-wrap">
    <h3 class="widget-title">
        Tags
    </h3>
    <div class="widget">
        <ul class="category-list">
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/tags/dotfiles">
                    dotfiles
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/tags/language-server-protocol">
                    language-server-protocol
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/tags/linux">
                    linux
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/tags/macos">
                    macos
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/tags/pdp-11">
                    pdp-11
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/tags/pdp-11/40">
                    pdp-11/40
                </a>
                <span class="category-list-count">2</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/tags/tmux">
                    tmux
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/tags/ubuntu">
                    ubuntu
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/tags/unix">
                    unix
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/tags/unix-v6">
                    unix-v6
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/tags/vim">
                    vim
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/tags/wat">
                    wat
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/tags/web-audio-api">
                    web-audio-api
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/tags/webassembly">
                    webassembly
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/tags/webassembly-text-format">
                    webassembly-text-format
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://rilakkuma3xjapan.website/tags/zsh">
                    zsh
                </a>
                <span class="category-list-count">1</span>
            </li>
            
        </ul>
    </div>
</div>




    


<div class="widget-wrap">
    <h3 class="widget-title">
        Tag cloud
    </h3>
    <div class="widget tagcloud">
        
        
        <a href="https://rilakkuma3xjapan.website/tags/dotfiles" style="font-size: 12px;">dotfiles</a>
        
        
        <a href="https://rilakkuma3xjapan.website/tags/language-server-protocol" style="font-size: 12px;">language-server-protocol</a>
        
        
        <a href="https://rilakkuma3xjapan.website/tags/linux" style="font-size: 12px;">linux</a>
        
        
        <a href="https://rilakkuma3xjapan.website/tags/macos" style="font-size: 12px;">macos</a>
        
        
        <a href="https://rilakkuma3xjapan.website/tags/pdp-11" style="font-size: 12px;">pdp-11</a>
        
        
        <a href="https://rilakkuma3xjapan.website/tags/pdp-11/40" style="font-size: 12px;">pdp-11/40</a>
        
        
        <a href="https://rilakkuma3xjapan.website/tags/tmux" style="font-size: 12px;">tmux</a>
        
        
        <a href="https://rilakkuma3xjapan.website/tags/ubuntu" style="font-size: 12px;">ubuntu</a>
        
        
        <a href="https://rilakkuma3xjapan.website/tags/unix" style="font-size: 12px;">unix</a>
        
        
        <a href="https://rilakkuma3xjapan.website/tags/unix-v6" style="font-size: 12px;">unix-v6</a>
        
        
        <a href="https://rilakkuma3xjapan.website/tags/vim" style="font-size: 12px;">vim</a>
        
        
        <a href="https://rilakkuma3xjapan.website/tags/wat" style="font-size: 12px;">wat</a>
        
        
        <a href="https://rilakkuma3xjapan.website/tags/web-audio-api" style="font-size: 12px;">web-audio-api</a>
        
        
        <a href="https://rilakkuma3xjapan.website/tags/webassembly" style="font-size: 12px;">webassembly</a>
        
        
        <a href="https://rilakkuma3xjapan.website/tags/webassembly-text-format" style="font-size: 12px;">webassembly-text-format</a>
        
        
        <a href="https://rilakkuma3xjapan.website/tags/zsh" style="font-size: 12px;">zsh</a>
        
    </div>
</div>





    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

    
	</div>
</div>

<footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022
      Copyright (c) <a href="https://rilakkuma3xjapan.website/about/">Korilakkuma</a>
    </div>
  </div>
</footer>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-41390233-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script src="https://rilakkuma3xjapan.website/fancybox/jquery.fancybox.pack.js"></script>
<script src="https://rilakkuma3xjapan.website/js/script.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>


<script>hljs.initHighlightingOnLoad();</script>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>




</body>
</html>